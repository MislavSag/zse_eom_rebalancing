---
title: "Efekt rebalansiranja na Zagrebačkoj burzi"
format: pdf
execute:
  echo: false
  warning: false
language: _language.yml
bibliography: references.bib
tbl-cap-location: top
latex-auto-install: true
---

# Uvod

Efikasno upravljanje investicijskim portfeljima zahtijeva njihovo rebalansiranje, najčešće prema graničnom ili kalendarskom principu (Harvey i sur., 2025). Granično rebalansiranje odvija se kada alokacija imovine odstupa od unaprijed definiranih granica, dok kalendarsko rebalansiranje podrazumijeva redovite prilagodbe u jednakim vremenskim intervalima, obično mjesečno, tromjesečno ili godišnje. Iako postojeća literatura opsežno razmatra rebalansiranje portfelja i povezane kalendarske efekte na međunarodnim financijskim tržištima (Athanassakos, 2021; Hoffstein i sur., 2020), manje je pažnje posvećeno tržištima u nastajanju poput Zagrebačke burze (ZSE).

Ovaj rad ispituje kalendarski efekt rebalansiranja na hrvatskom financijskom tržištu analizirajući mjesečne sezonske obrasce u prinosima dioničkog indeksa CROBEX i obvezničkog indeksa CROBIS u razdoblju od rujna 2003. do ožujka 2025. godine. Točnije, istraživanje analizira utječu li sustavne razlike prinosa između dionica i obveznica na početku mjeseca na prinose ostvarene u zadnjim trgovinskim danima mjeseca. Za razliku od prethodnih istraživanja, 

ovaj rad uvodi robusni metodološki okvir koji kombinira regresijsku analizu sa simuliranom investicijskom strategijom  . Empirijska strategija u radu dodatno uključuje provjeru robusnosti rezultata varirajući točku unutar mjeseca u kojoj se provodi rebalans, kako bi se utvrdilo jesu li uočeni kalendarski efekti osjetljivi na specifičan vremenski okvir rebalansiranja.

Doprinos rada očituje se u tri ključna aspekta. Prvo, rad pruža empirijski uvid u odnos između dinamike dioničkog i obvezničkog tržišta na Zagrebačkoj burzi. Drugo, rezultati potvrđuju postojanje i ekonomsku značajnost mjesečnih kalendarskih efekata u prinosima, naglašavajući tako mogućnosti za povećanje profitabilnosti portfeljnih menadžera i individualnih investitora. Konačno, rad razmatra praktične implikacije nalaza, sugerirajući moguće poboljšanje strategija rebalansiranja portfelja koje bi mogle doprinijeti većoj tržišnoj efikasnosti, profitabilnosti i prinosima investitora. Razumijevanje ovih kalendarskih efekata stoga može biti od koristi investitorima, kreatorima politika i regulatornim tijelima u cilju optimizacije tržišnih performansi i stabilnosti.

U nastavku rada slijedi pregled literature koji donosi teorijske i empirijske uvide o rebalansiranju portfelja i kalendarskim efektima. U poglavlju 3 opisani su korišteni podaci i metodologija, dok poglavlje 4 prezentira rezultate regresijske analize i simulirane investicijske strategije. Zaključni dio rada (poglavlje 5) sažima ključne nalaze te razmatra praktične implikacije.

# Literatura

Kalendarske anomalije već desetljećima predstavljaju jedno od najčešćih područja istraživanja u okviru testiranja hipoteze efikasnog tržišta (Fama, 1970). Opsežna literatura dokumentirala je različite anomalije, od kojih su najpoznatije efekt ponedjeljka, siječanjski efekt, učinak prelaska mjeseca, polumjesečni učinak, učinak blagdana te Halloween efekt.

Efekt ponedjeljka, poznat i kao vikend ili učinak dana u tjednu, odnosi se na pojavu sustavno nižih prinosa ponedjeljkom u odnosu na ostale dane u tjednu. Ovaj fenomen potvrđen je na različitim tržištima, uključujući i ona u razvoju (Cross, 1973; Gibbons i Hess, 1981; Dubois i Louvet, 1996; Dicle i Levendis, 2014; Chiah i Zhong, 2021). Siječanjski efekt, ili mjesečni efekt, opisuje anomaliju većih prinosa u siječnju u usporedbi s drugim mjesecima, često objašnjavan poreznim efektima ili institucionalnim ponašanjem poput „window dressinga“ (Gultekin i Gultekin, 1983; Haugen i Jorion, 1996; Mehdian i Perry, 2002; Chen i Schmidt, 2021).

Efekt prelaska mjeseca podrazumijeva više prosječne prinose tijekom zadnjih dana jednog mjeseca i prvih dana sljedećeg mjeseca (Ariel, 1987; Lakonishok i Smidt, 1988; Barone, 1990; Kunkel i sur., 2003; McConnell i Xu, 2008). Polumjesečni efekt odnosi se na tendenciju ostvarenja većih prinosa u prvoj polovici mjeseca u odnosu na drugu polovicu (Lakonishok i Smidt, 1988; Mills i Coutts, 1995; Tonchev i Kim, 2004). Učinak blagdana manifestira se višim prinosima neposredno prije prazničnih dana kada burze ne rade (Ariel, 1990; Lakonishok i Smidt, 1988). Halloween efekt, ili „prodaj u svibnju“ fenomen, karakteriziran je iznadprosječnim prinosima u razdoblju od studenog do travnja u odnosu na razdoblje od svibnja do listopada (Bouman i Jacobsen, 2002; Doeswijk, 2008; Dichtl i Drobetz, 2015; Carrazedo i sur., 2016).

Iako je literatura o kalendarskim anomalijama opsežna, većina postojećih radova fokusirana je na razvijena tržišta poput SAD-a i europskih burzi (Tadepalli i Jain, 2018). Međutim, posljednjih godina sve je veći interes za istraživanja kalendarskih efekata na tržištima zemalja u razvoju i tržištima u nastajanju, potaknut globalizacijom, integracijom financijskih tržišta te razvojem elektroničke trgovine (Choudhry, 2000; Al-Loughani i Chappell, 2001; Basher i Sadorsky, 2006; Ariss i sur., 2011; Al-Ississ, 2015; Seif i sur., 2017). Razumijevanje ovih anomalija važno je lokalnim i međunarodnim investitorima zbog mogućnosti optimizacije portfelja, odabira investicijskih strategija i ostvarivanja bolje diverzifikacije. Pored toga, istraživanja kalendarskih anomalija na tržištima u nastajanju predstavljaju vrijedan test efikasnosti tržišta izvan uzorka razvijenih zemalja, posebice zbog specifičnosti institucionalnih okvira, pravnih sustava, sentimenta investitora, likvidnosti i veličine tržišta.

U literaturi o tržištima srednje i istočne Europe, uključujući Hrvatsku, postoje različiti rezultati o prisutnosti kalendarskih anomalija, poput negativnih prinosa ponedjeljkom ili pozitivnih učinaka prelaska mjeseca (Patev i sur., 2003; Stoica i Diaconasu, 2011; Heinineni i Puttonen, 2008). Ipak, hrvatsko tržište još uvijek nije dovoljno istraženo, a empirijski nalazi o prisutnosti kalendarskih anomalija nisu konzistentni (Fruk, 2004; Škrinjarić, 2012).

Upravljanje investicijskim portfeljima u kontekstu kalendarskih anomalija često uključuje strategije rebalansiranja. Strategija kalendarskog rebalansiranja podrazumijeva prilagodbu sastava portfelja u jednakim vremenskim intervalima, primjerice mjesečno ili kvartalno, pri čemu izbor vremenske točke rebalansiranja može utjecati na ukupni prinos i volatilnost portfelja (Harvey, 2025; Hoffstein i sur., 2020). Hoffstein i sur. (2020) naglašavaju važnost „sreće rebalansiranja“ (engl. rebalance timing luck), upozoravajući na značajne razlike u prinosima ovisno o odabiru dana unutar mjeseca kada se provodi rebalans. Slično tome, Athanassakos (2021) povezuje mjesečne sezonalnosti prinosa s institucionalnim strategijama rebalansiranja, poput „window dressinga“ i „performance chasinga“.

Nadovezujući se na postojeću literaturu, ovaj rad istražuje kalendarske efekte i utjecaj kalendarskog rebalansiranja na hrvatskom financijskom tržištu, kombinirajući regresijsku analizu i simulaciju različitih strategija. Cilj je identificirati moguće anomalije te njihovu iskoristivost za povećanje profitabilnosti ulaganja na Zagrebačkoj burzi, doprinoseći pritom boljem razumijevanju tržišne dinamike i efikasnosti hrvatskog tržišta kapitala.

# Podaci i metodologija

```{r}
options(digits = 4) 

library(fastverse)
library(ggplot2)
library(patchwork)
library(PerformanceAnalytics)
library(roll)
library("lmtest")
library("sandwich")
library(readxl)
library(flextable)
library(modelsummary)
library(readxl)
library(janitor)
library(kableExtra)

# ggplot options
theme_set(theme_minimal())
```

```{r}
# Function to clean data
clean_mf = function(sheet_name = "A") {
  a = read_excel("data/mf.xlsx", sheet = sheet_name)
  setDT(a)
  a = transpose(a, keep.names = "date")
  cols = c("date", unlist(a[1, 2:ncol(a)], use.names = FALSE))
  a = a[2:nrow(a)]
  a[, date := as.Date(as.integer(date), origin = "1899-12-30")]
  setnames(a, cols)
  a = clean_names(a)
  a = a[, names(.SD) := lapply(.SD, as.numeric), .SDcols = -"date"]
  a[, fund := sheet_name]
  return(a)
}
```

```{r}
# Read data
crobis = as.data.table(read_excel("data/cbx_cbs.xls", sheet = 1))
crobex = as.data.table(read_excel("data/cbx_cbs.xls", sheet = 2))
crobis[, datum := as.Date(datum, format = "%m/%d/%Y")]
crobex[, datum := as.Date(datum, format = "%m/%d/%Y")]
date_same = intersect(crobex[, datum], crobis[, datum])
dt = rbind(crobex, crobis)

# Basic cleaning 
dt = dt[datum %in% date_same]
dt[, symbol := tolower(indeks)]
dt = dt[, .(symbol, date = datum, last_value = vrijednost)]
setorder(dt, symbol, date)

# Define days of month
dt[, month := data.table::yearmon(date)]
setorder(dt, symbol, date)
month_date = unique(dt[, .(month, date)])
setorder(month_date, date)
month_date[, day_of_month := 1:.N, by = .(month)]
dt = month_date[, .(date, day_of_month)][dt, on = c("date")]
dt[, day_of_month := as.factor(day_of_month)]
# dt[, .N, by = day_of_month][order(day_of_month)]
dt[day_of_month == 23, day_of_month := 22] # 23 day to 22 day
dt[day_of_month == 22, day_of_month := 21] # not sure about this but lets fo with it

# Calculate momentum
dt[, returns := last_value / shift(last_value) - 1, by = .(symbol)]
dt[, momentum_month := shift(last_value, 1) / shift(last_value, 3) - 1, by = .(symbol, day_of_month)]
dt[, momentum_year := shift(last_value, 1) / shift(last_value, 12) - 1, by = .(symbol, day_of_month)]

# Remove missing values
dt = na.omit(dt)

# Extract CROBEX and CROBIS
crobex = dt[symbol == "crobex"]
crobis = dt[symbol == "crobis"]
crobex_xts = as.xts.data.table(crobex[, .(date, last_value, returns)])
crobis_xts = as.xts.data.table(crobis[, .(date, last_value, returns)])
```

```{r}
# Plot series
g1 = ggplot(crobex, aes(x = date, y = last_value)) +
  geom_line() +
  labs(title = "", x = "Godine", y = "CROBEX indeks") +
  scale_x_date(date_breaks = "year", date_labels = "%y") +
  theme_minimal() +
  theme(legend.position = "bottom")
g2 = ggplot(crobis, aes(x = date, y = last_value  )) +
  geom_line() +
  labs(title = "", x = "Godine", y = "CROBIS indeks") +
  scale_x_date(date_breaks = "year", date_labels = "%y") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
# Dependencies
returns_wide = dcast(dt, date ~ symbol, value.var = "returns")
returns_only = returns_wide[, -c("date")]
corr_pearson = cor(returns_only[, 1], returns_only[, 2], method = "pearson",  use = "complete.obs")
corr_spearman = cor(returns_only[, 1], returns_only[, 2], method = "spearman",  use = "complete.obs")
corr_kendall = cor(returns_only[, 1], returns_only[, 2], method = "kendall",  use = "complete.obs")
dep = data.table(
  Pearson  = round(corr_pearson, 4),
  Spearman = round(corr_spearman, 4),
  Kendall  = round(corr_kendall, 4)
)
```


U radu se koriste podatci za CROBEX  index, koji odražava dinamiku dioničkog tržišta RH i CROBIS index, koji prati kretanje obvezničkog tržišta RH. Podatci su preuzeti su s internetskih stranica Zagrebačke burze na dnevnoj frekvenciji, za razdoblje od 1. rujna 2003. do 7. ožujka 2025. Prinose CROBEX indeksa karakterizira veća standardna devijacija (`r dt[symbol == "crobex", sd(returns)]`) i prosječni dnevni prinos (`r dt[symbol == "crobex", mean(returns)]`) te veći raspon, u odnosu na standardnu devijaciju dnevnih prinosa (`r dt[symbol == "crobis", mean(returns)]`) i prosječni dnevni prinos (`r dt[symbol == "crobex", sd(returns)]`  ) CROBIS indeksa.  Tri korelacijske mjere (Pearson (`r dep[, Pearson.crobis]`), Spearman (`r dep[, Spearman.crobis]`), Kendall (`r dep[, Kendall.crobis]`)) između CROBEX i CROBIS indeksa upućuju da među njima nema izražene međuovisnosti.

```{r}
#| label: fig-series
#| fig-cap: "Kretanje  CROBEX i CROBIS indeksa u razdoblju 2003. do 2025. godine"

g1 / g2
```

Slika @fig-series prikazuje  kretanje CROBEX i CROBIS indeksa od 2003. godine do danas. Vidljivo je da su indeksi slijedili različite putanje, pod utjecajem kako domaćih gospodarskih okolnosti, tako i globalnih trendova. Kretanje indeksa CROBEX, koji je dosegnuo povijesni vrhunac u prosincu 2007. godine (5.239 bodova), a  u veljači 2025. godine iznosi oko 3.300 bodova, odražava volatilnu prirodu tržišta dionica. CROBEX indeks karakterizira izrazita volatilnosti, s jakim rastom prije globalne financijske krize, nakon čega je uslijedio pad 2008. i 2009. godine, a zatim dugoročno razdoblje stagnacije, tijekom kojeg nije dosegnuo ranije ostvarene razine. S druge strane, indeks CROBIS, koji je vrhunac dosegnuo u rujnu 2019. godine (116,901 bodova), pokazuje manju volatilnost te je u veljači 2025. godine iznosio 99,255 bodova. Dugoročno gledajući, CROBIS je uglavnom ostvarivao stabilan rast, potaknut globalnim razdobljem niskih kamatnih stopa, uz iznimku snažnog pada tijekom 2022. godine zbog porasta kamatnih stopa kao posljedice inflacijskih pritisaka. 

Kako bi se utvrdilo postojanje kalendarskog efekta na Zagrebačkoj burzi, provedena je regresijska analiza i simulacija investicijske strategije (IS) pri čemu je cilj analize identificirati obrasce kretanja CROBEX i CROBIS indeksa u posljednjim trgovinskim danima kalendarskog mjeseca. Regresijski model kojim se ispituje kalendarski efekt ima sljedeći  oblik:

$$Ret_{e} = \alpha + \beta_1 Ret_{b} + \delta' X_t + \epsilon_t$$

gdje je $Ret_{e}$ razlika prinosa CROBEX-a i CROBIS-a zadnjih 5 trgovinskih dana u kalendarskom mjesecu, a $Ret_{b}$ razlika prinosa CROBEX-a i CROBIS-a prvih 15 trgovinskih dana u kalendarskom mjesecu. Koeficijent $β_1$ mjeri utjecaj razlike prinosa prvih 15 dana u mjesecu na razliku prinosa zadnjih 5 dana u mjesecu. Statistički značajan i negativan $β_1$ koeficijent ukazuje na postojanje kalendarskog efekta. Matrica $X_t$ sadrži kontrolne varijable mjesečnih i godišnjih momentuma. $ε_t$ predstavlja greške modela i obuhvaća sve ostale, neobjašnjene varijacije u prinosima.

Osim regresijskog pristupa, kalendarski efekt se ispituje simuliranjem investicijske strategije (IS) temeljene na rebalansiranju portfelja tijekom posljednjih pet trgovinskih dana u svakom kalendarskom mjesecu.
IS je ustrojena na sljedeći način. Prvo se računa se razlika u kumulativnim dnevnim prinosima indeksa tijekom 15 trgovinskih dana kalendarskog mjeseca:  

$$RelR_{t} = \sum_{i=t-15}^{t-1} (R_i^{CROBEX} - R_i^{CROBIS})$$

Ako je razlika prinosa CORBEX-a i CROBIS-a u prvih 15 trgovinskih dana pozitivna, zauzima se duga pozicija u CROBIS-u, a ako je negativna ili jednaka nuli, ulaže se u CROBEX.  Zauzimaju se isključivo duge pozicije zbog ograničenja na Zagrebačkoj burzi, gdje kratka prodaja dionica nije moguća. Formalno, portfelj se rebalansira prema pravilu:

$$
Portfelj_{t} = 
\begin{cases}
\text{kupi CROBIS}, & \text{ako je } RelR_{t} > 0 \\[6pt]
\text{kupi CROBEX}, & \text{ako je } RelR_{t} \leq 0
\end{cases}
$$

Odabrani portfelj zadržava se idućih pet trgovinskih dana, do kraja kalendarskog mjeseca, nakon čega se postupak ponavlja. Rezultati IS prikazani su pomoću kumulativnog prinosa, te vrednovani standardnim pokazateljima performansi portfelja: Sharpeovim omjerom, godišnjim prinosom i maksimalnim gubitkom vrijednosti od posljednje najviše ostvarene vrijednosti(engl. „drawdown“).

Na slici Figure 3 prikazana je razlika prinosa između indeksa CROBEX i CROBIS tijekom prvog dijela mjeseca (prvih 15 trgovinskih dana). Pozitivne vrijednosti ukazuju na relativno snažniji rast CROBEX-a u odnosu na CROBIS, dok negativne vrijednosti pokazuju suprotan odnos.  Centralna tendencija razlike varira oko nule, uz brze korekcije odmaka nazad prema toj razini. U posljednjem tjednu u mjesecu u pravilu dolazi do povratka u relativnom učinku dionica u odnosu na obveznice. Ako su dionice tijekom mjeseca nadmašivale obveznice, u zadnjem tjednu ta prednost često slabi ili se čak poništava. Ova pojava može biti posljedica portfeljskih prilagodbi institucionalnih investitora koji zatvaraju pozicije ili rebalansiraju imovinu pred kraj mjeseca.

```{r}
# Performance
performance = function(ret) {
  # ret = returns_xts
  # ret = crobex_xts[, 2]
  # Performance measures
  sr = SharpeRatio.annualized(ret)
  rownames(sr) = "Anualizirani Sharpeov omjer"
  reta = Return.annualized(ret)
  rownames(reta) = "Anualizirani prinos"
  dd = Drawdowns(ret)
  dd = as.data.table(dd)[, .(x = min(.SD)), .SDcols = 2, env = list(x = colnames(dd)[1])]
  dd = cbind(var = "Drawdown", dd)
  
  # 
  rbind(
    as.data.table(sr, keep.rownames = "var"),
    as.data.table(reta, keep.rownames = "var"),
    dd
  )
}
```

```{r}
# Calculate returns 5 day before end of the month and returns last 5 days of the month
ret_1 = dt[, .(ret_1 = .SD[day_of_month == 1, last_value] / .SD[day_of_month == 16, last_value] - 1),
   by = .(symbol, month)]
ret_2 = dt[, .(ret_2 = data.table::last(.SD[, last_value]) / .SD[day_of_month == 16, last_value] - 1),
   by = .(symbol, month)]

# Merge ret_1 and ret_2
returns_vars = merge(ret_1, ret_2, by = c("symbol", "month"))
returns_vars = dcast(returns_vars, month ~ symbol, 
                     value.var = c("ret_1", "ret_2"))
returns = na.omit(returns_vars)

# Ratio of Crobex and Crobis
returns[, ratio := ret_1_crobex - ret_1_crobis]

# Momentum
returns[, mom_month := shift(ratio, 1) / shift(ratio, 2) - 1]
returns[, mom_year := shift(ratio, 1) / shift(ratio, 12) - 1]

# Strategy
returns[, strategy := ifelse(ret_1_crobex > ret_1_crobis, ret_2_crobis, ret_2_crobex)]
returns[, strategy_big := ifelse(ret_1_crobex > (ret_1_crobis + 0.03), ret_2_crobis, ret_2_crobex)]
returns_xts = as.xts.data.table(returns[, .(zoo::as.Date.yearmon(month), strategy)])
returns_big_xts = as.xts.data.table(returns[, .(zoo::as.Date.yearmon(month), strategy_big)])
```

```{r}
#| label: fig-ratio
#| fig-cap: "Nezavisna varijabla - razlika prinosa CROBEX-a i CROBIS-a u prvih 15 regovinskih dana u mjeescu"

ggplot(returns, aes(x = month, y = ratio)) +
  geom_line() +
  # ggtitle("Razlika prinosa CROBEX'a i CROBIS-a u prvom dijelu mjeseca") +
  labs(x = "Mjeseci", y = "Razlika prinosa CROBEX-a i CROBIS-a")
```

Na slici @fig-ratio prikazana je razlika prinosa između indeksa CROBEX i CROBIS tijekom prvog dijela mjeseca (prvih 15 trgovinskih dana). Pozitivne vrijednosti ukazuju na relativno snažniji rast CROBEX-a u odnosu na CROBIS, dok negativne vrijednosti pokazuju suprotan odnos.  Centralna tendencija razlike varira oko nule, uz brze korekcije odmaka nazad prema toj razini. U posljednjem tjednu u mjesecu u pravilu dolazi do povratka u relativnom učinku dionica u odnosu na obveznice. Ako su dionice tijekom mjeseca nadmašivale obveznice, u zadnjem tjednu ta prednost često slabi ili se čak poništava. Ova pojava može biti posljedica portfeljskih prilagodbi institucionalnih investitora koji zatvaraju pozicije ili rebalansiraju imovinu pred kraj mjeseca.

```{r}
#| label: fig-bar-mean
#| fig-cap: "Prosječni i medijalni prinosi CROBEX-a u zadnjem tjednu"


g1 = returns[, .(crobex_return = mean(ret_2_crobex)), 
        by = .(ratio = factor(ratio > 0, labels = c("DA", "NE")))] |>
  ggplot(data = _, aes(x = ratio, y = crobex_return)) +
  geom_bar(stat = "identity") +
  labs(y = "Prinos CROBEX-a u zadnjem tjednu",
       x = "Prinos CROBEX-a veći od CROBIS-a") +
  ggtitle("Prosječni prinos")
g2 = returns[, .(crobex_return = median(ret_2_crobex)), 
        by = .(ratio = factor(ratio > 0, labels = c("DA", "NE")))] |>
  ggplot(data = _, aes(x = ratio, y = crobex_return)) +
  geom_bar(stat = "identity") +
  labs(y = "Prinos CROBEX-a u zadnjem tjednu",
       x = "Prinos CROBEX-a veći od CROBIS-a") +
  ggtitle("Medijalni prinos")
g1 + g2 + plot_layout(axes = "collect", axis_titles = "collect", guides = "collect")
```

Na slici @fig-bar-mean prikazana je usporedba prinosa CROBEX indeksa u posljednjem tjednu  mjeseca . Lijevi stupac na oba grafikona prikazuje prinose CROBEX indeksa, kada je njegov prinos u prvom dijelu mjeseca bio niži od CROBIS indeksa, dok desni stupac prikazuje prinose CROBEX indeksa u svakom posljednjom tjednu mjeseca, neovisno o razlici prinosa CROBEX-a i CROBIS-a u prvom dijelu mjeseca. Prosječni i medijalni prinosi CROBEX indeksa su otprilike 0,5 % veći kada ih se uvjetuje razlikom prinosa između CROBEX i CROBIS indeksa u prvih 15 trgovinskih dana, što se može tumačiti kao naznaka kalendarskog efekta.

```{r}
#| label: fig-bar-crobis
#| fig-cap: "Prosječni i medijalni prinosi CROBIS-a u zadnjem tjednu"


g1 = returns[, .(crobis_return = mean(ret_2_crobis)), 
        by = .(ratio = factor(ratio < 0, labels = c("DA", "NE")))] |>
  ggplot(data = _, aes(x = ratio, y = crobis_return)) +
  geom_bar(stat = "identity") +
  labs(y = "Prinos CROBIS-a u zadnjem tjednu",
       x = "Prinos CROBIS-a veći od CROBEX-a") +
  ggtitle("Prosječni prinos")
g2 = returns[, .(crobis_return = median(ret_2_crobis)), 
        by = .(ratio = factor(ratio < 0, labels = c("DA", "NE")))] |>
  ggplot(data = _, aes(x = ratio, y = crobis_return)) +
  geom_bar(stat = "identity") +
  labs(y = "Prinos CROBIS-a u zadnjem tjednu",
       x = "Prinos CROBIS-a veći od CROBEX-a") +
  ggtitle("Medijalni prinos")
g1 + g2 + plot_layout(axes = "collect", axis_titles = "collect", guides = "collect")
## Kalendarski efekt - pristup investicijske strategije
```

Na slici @fig-bar-crobis su vidljivi viši prosječni i medijalni prinosi CROBIS indeksa kada su oni uvjetovani razinom prinosa CROBEX indeksa u odnosu na prinos CROBIS indeksa u prvom dijelu mjeseca. Na lijevom panelu je vidljivo kako su prosječni prinosi CROBIS indeksa negativni kada se promatraju svi posljednji tjedni u svim mjesecima  , a postaju pozitivni kada se uzmu u obzir samo slučajevi u kojima je prinos CROBEX indeksa bio relativno veći u prvoj polovici mjeseca. Na jednak zaključak navode i medijalni prinosi, prikazani na desnome panelu.   

# Rezultati

U prvom dijelu ovoga poglavlja prikazani su rezultati provedene regresijske analize, uključujući dvije specifikacije regresijskog modela. U drugome dijelu poglavlja prikazani su rezultati simulirane 

## Statistička analiza

Zavisna varijabla u regresijskom modelu definirana je kao razlika prinosa CROBEX i CROBIS indeksa u  zadnjem dijelu mjeseca (od 16. trgovinskog dana do zadnjeg trgovinskog dana u mjesecu), dok nezavisna varijabla predstavlja razliku prinosa u prvom dijelu mjeseca (od 1. do 15. trgovinskog dana u mjesecu). Pri tome se očekuje negativna povezanost između ovih dviju varijabli. Ukoliko je CROBEX indeks ostvario relativno viši prinos u prvoj polovici mjeseca, u prosjeku se očekuje korekcija (smanjenje) viška prinosa u odnosu na CROBIS indeks u drugoj polovici mjeseca. U drugoj regresijskoj specifikaciji, provedenoj u cilju kontrole robusnosti rezultata, model je proširen kontrolnim varijablama mjesečnog i godišnjeg momentuma oba indeksa , te su iz uzorka isključene ekstremne opservacije, karakteristične za razdoblje pandemije COVID-19. Kontrolne variajble uključuju mjesečni i godišnji momentum. Mjesečni momentum se računa kao omjer cijene indeksa na kraju prethodnog mjeseca i cijene dva mjeseca unatrag, umanjen za jedan. Godišnji momentum se računa kao omjer cijene na kraju prethodnog mjeseca i cijene 12 mjeseci unazad, također umanjen za jedan.

```{r}
#| label: fig-calendar-reg
#| fig-cap: "Dijagram raspršenosti razlike prinosa CROBEX-a nad CROBIS-om i jednostavna linerna regresija razlike prinosa u zadnjem tjednu na razliku prinosa u prvom dijelu mjeseca"

outperformance = returns[, .(
  month,
  ratio_1 = ret_1_crobex - ret_1_crobis,
  ratio_2 = ret_2_crobex - ret_2_crobis,
  mom_month,
  mom_year
)]

ggplot(outperformance, aes(x = ratio_1, y = ratio_2)) +
    geom_point() +
    geom_smooth(method = "lm", color = "black") +
      labs(
        x = "Razlika prinosa u prvom dijelu mjeseca",
        y = "Razlika prinosa u zadnjem tjednu",
        title = ""
      )
```

Na slici @fig-calendar-reg prikazane su razlike   prinosa CROBEX i CROBIS indeksa u drugom dijelu mjeseca (na osi Y) u odnosu na razlike njihovih prinosa u prvom dijelu mjeseca (na osi X) i pripadajući regresijski pravac. Vidljiv je negativan nagib regresijskog pravca, što sugerira da se veća odstupanja u prvoj polovici mjeseca korigiraju prema srednjoj vrijednosti do kraja mjeseca

```{r}
#| label: tab-calendar-reg
#| tab-cap: "Rezultati regresijske analize kalendarskog efekta"
#| tbl-cap-location: top

m_calendar = lm(ratio_2 ~ ratio_1, data = outperformance)
m_calendar_x = lm(ratio_2 ~ ratio_1 + mom_month + mom_year, data = outperformance)

msummary(list(`LM 1` = m_calendar, 
              `LM 2` = m_calendar_x, 
              `LM HAC 1` = m_calendar, 
              `LM HAC 2` = m_calendar_x), 
         statistic = "{std.error} ({p.value})",
         vcov = c("classical", "classical", "HC3", "HC3"), 
         coef_map = c(
           `(Intercept)` = "Odsječak",
           ratio_1 = "RelR",
           mom_month = "Mom_mjesec",
           mom_year = "Mom_godina"),
         stars = TRUE,
         # output = "latex",
         notes = list('Tablica prikazuje procjene regresijskih koeficijenata i standardne greške specifikacije dane u 1.'))
```

Nakon deskriptivne analize podataka, rezultati procjene parametara prvog regresijskog modela prikazani su u tablici @tab-calendar-reg. U prve dvije kolone tablice (LM 1 i LM 2) prikazane su procjene uz pretpostavku homoskedastičnosti rezidualne strukture, dok su u trećoj i četvrtoj koloni (LM HAC 1 i LM HAC 2) prikazane procjene standardnih pogrešaka prilagođene za heteroskedastičnost (robustne standardne pogreške). Rezultati iz prve specifikacije (LM 1) pokazuju da je koeficijent $β_1$ statistički značajan i negativan, što potvrđuje postojanje kalendarskog efekta. U specifikaciji s kontrolnim varijablama (LM 2), koeficijent $β_1$ zadržava negativan predznak, ali uz prilagodbu standardnih pogrešaka na heteroskedastičnost (LM HAC 1 i LM HAC 2) koeficijent gubi statističku značajnost.

```{r}
#| label: tab-calendar-reg-outlier
#| tab-cap: "Rezultati regresijske analize kalendarskog efekta bez jedne opservacije"

m_calendar = lm(ratio_2 ~ ratio_1, data = outperformance[ratio_1 < 0.3])
m_calendar_x = lm(ratio_2 ~ ratio_1 + mom_month + mom_year, data = outperformance[ratio_1 < 0.3])

msummary(list(`LM 1` = m_calendar, 
              `LM 2` = m_calendar_x, 
              `LM HAC 1` = m_calendar, 
              `LM HAC 2` = m_calendar_x), 
         statistic = "{std.error} ({p.value})",
         vcov = c("classical", "classical", "HC3", "HC3"), 
         coef_map = c(
           `(Intercept)` = "Odsječak",
           ratio_1 = "RelR",
           mom_month = "Mom_mjesec",
           mom_year = "Mom_godina"),
         stars = TRUE,
         notes = list('Tablica prikazuje procjene regresijskih koeficijenata i standardne greške specifikacije dane u 1.'))
```

Rezultati druge regresijske specifikacije, prikazani su u tablici @tab-calendar-reg-outlier, iz koje je vidljivo da koeficijent $β_1$ ponovno postaje statistički značajan u svim specifikacijama, uz razinu značajnosti od 0,1%. Dobiveni nalazi stoga robusno potvrđuju postojanje kalendarskog efekta rebalansiranja u dinamici razlika prinosa između CROBEX-a i CROBIS-a. 

## Simulirana regresijska strategija

Nakon regresijske analize, u nastavku su prikazani rezultati simulirane investicijske strategije (SI) rebalansiranja portfelja, zasnovane na potvrđenom kalendarskom efektu. Na slici Figure 8 prikazana je krivulja kapitala IS te pripadajući graf maksimalnog nerealiziranog pada vrijednosti portfelja. Vidljivo je da IS ostvaruje stabilan i relativno ujednačen rast kapitala tijekom promatranog razdoblja pri čemu je kumulativni prinos veći od 150 %, a maksimalni zabilježeni pad iznosi 7,5 %. 

```{r}
#| label: fig-strategy
#| fig-cap: 'Kumulativni prinos i maksimalni nerealizirani gubitak investicijske ("deawdown") strategije'

g1 = chart.CumReturns(returns_xts, plot.engine = "ggplot2") +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  theme(
    legend.position = "none"
  ) +
  scale_color_grey() +
  # ggtitle("Prinos investicijske strategije")
  labs(x = "Godine", y = "Kumulativni prinos")
g2 = chart.Drawdown(returns_xts, plot.engine = "ggplot2") +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  theme(
    legend.position = "none"
  ) +
  scale_color_grey() +
  # ggtitle("Drawdown investicijske strategije")
  labs(x = "Godine", y = "Drawdown")
g1 / g2
```

```{r}
#| label: tab-strategy
#| tab-cap: "Performance of the calendar effect strategy"

# Calculate portfolio performances
strategy_calendar_perf = performance(returns_xts)
setnames(strategy_calendar_perf, c("var", "calendar"))
crobex_perf = performance(crobex_xts[, 2])
names(crobex_perf)[2] = "CROBEX"
crobis_perf = performance(crobis_xts[, 2])
names(crobis_perf)[2] = "CROBIS"

# Translate to Croatian
dt_ = cbind(strategy_calendar_perf, crobex_perf[, 2], crobis_perf[, 2])
setnames(dt_, c("Mjera performansi", "Kalendar", "CROBEX", "CROBIS"))

# Create flextable
ft = flextable(dt_)
ft = set_caption(ft, caption = "Performance of the calendar effect strategy")
ft = autofit(ft)                # auto-adjust column widths
ft = theme_vanilla(ft)          # optional theme

# Print the flextable
ft
```

Usporedba ključnih pokazatelja performansi IS u odnosu na prinos CROBEX i CROBIS   indeksa prikazana je u tablici @tab-strategy. Vidljivo je da IS ostvaruje značajno bolje omjere prinosa i rizika. Iako je ukupni prinos strategije približno jednak prinosu indeksa CROBEX, IS to postiže uz niži rizik: najveći gubitak CROBEX-a tijekom analiziranog razdoblja iznosio je čak 76 %, dok je najveći gubitak strategije ostao ograničen na spomenutih 7,5 %. Pri tome valja istaknuti Sharpeov omjer IS od 0,88, koji je višestruko viši u odnosu na prinose promatranih indeksa.

```{r}
#| label: tab-strategy-costs
#| tab-cap: "Performance of the calendar effect strategy"

# Define cost
c = 0.002

# Calculate portfolio performances
strategy_calendar_perf = performance(returns_xts - 0.002)
setnames(strategy_calendar_perf, c("var", "calendar"))
crobex_perf = performance(crobex_xts[, 2])
names(crobex_perf)[2] = "CROBEX"
crobis_perf = performance(crobis_xts[, 2])
names(crobis_perf)[2] = "CROBIS"

# Translate to Croatian
dt_ = cbind(strategy_calendar_perf, crobex_perf[, 2], crobis_perf[, 2])
setnames(dt_, c("Mjera performansi", "Kalendar", "CROBEX", "CROBIS"))

# Create flextable
ft = flextable(dt_)
ft = set_caption(ft, caption = "Performance of the calendar effect strategy")
ft = autofit(ft)                # auto-adjust column widths
ft = theme_vanilla(ft)          # optional theme

# Print the flextable
ft
```

Prikazani rezultati IS ne uzimaju u obzir troškove trgovanja, a  koji uključuju brokerske naknade, razliku između ponude i potražnje (bid-ask spreadove), tržišni utjecaj, poreze i druge troškove. Zanemarivanje ovih troškova stoga može značajno precijeniti stvarnu profitabilnost strategije. Zbog toga je u nastavku provedena proširena IS uz pretpostavku fiksnih transakcijskih troškova od 0,1 % za svaku izvršenu transakciju. Budući da strategija na kraju svakog mjeseca provodi jednu kupnju i jednu prodaju, ukupni mjesečni troškovi trgovanja iznose 0,2 postotnih booda. Rezultati proširene IS prikazani su u tablici @tab-strategy-costs, u kojoj je sada vidljiv niži ukupni prinos. Ipak, uzevši u obzir i dalje izraženo viši Sharpeov omjer, IS potvrđuje svoju ekonomsku i investicijsku relevantnost.


# Analiza robusnosti

## Kalendarski efekt početkom mjeseca

Prethodno  potvrđeni kalendarski efekt  je nastao uvjetovanjem prinosa indeksa CROBEX i CROBIS u zadnjem tjednu mjeseca na njihove prinose u prvoj polovici mjeseca. U cilju robusnosti potvrde kalendarskog efekta, u provedena je analiza drugačije specificiranog vremenskog razdoblja: prinosi u zadnja tri tjedna kalendarskog mjeseca (od 6. do 21. trgovinskog dana) kao prvi period, a prinosi u prvom tjednu sljedećeg mjeseca kao drugi period.

```{r}
# Calculate returns 5 day before end of the month and returns last 5 days of the month
ret_1_ = dt[, .(ret_1 = data.table::last(.SD[, last_value]) / .SD[day_of_month == 6, last_value] - 1),
           by = .(symbol, month)]
ret_2_ = dt[, .(ret_2 = .SD[day_of_month == 5, last_value] / .SD[day_of_month == 1, last_value] - 1),
           by = .(symbol, month)]

# Merge ret_1 and ret_2
returns_ = merge(ret_1_, ret_2_, by = c("symbol", "month"))
returns_[, ret_1 := shift(ret_1)]
returns_ = dcast(returns_, month ~ symbol, value.var = c("ret_1", "ret_2"))
returns_ = na.omit(returns_)

# Strategy
returns_[, strategy := ifelse(ret_1_crobex > ret_1_crobis, ret_2_crobis, ret_2_crobex)]
returns_xts_ = as.xts.data.table(returns_[, .(zoo::as.Date.yearmon(month), strategy)])

outperformance = returns_[, .(
  month,
  ratio_1 = ret_1_crobex - ret_1_crobis,
  ratio_2 = ret_2_crobex - ret_2_crobis
)]
```

```{r}
#| label: tab-calendar-reg-start
#| tab-cap: "Rezultati regresijske analize kalendarskog efekta"

m_calendar = lm(ratio_2 ~ ratio_1, data = outperformance)

msummary(list(`LM 1` = m_calendar, 
              `LM HAC 1` = m_calendar), 
         statistic = "{std.error} ({p.value})",
         vcov = c("classical", "HC3"), 
         stars = TRUE,
         notes = list('Tablica prikazuje procjene regresijskih koeficijenata i standardne greške specifikacije dane u 1.'))
```

```{r}
#| label: fig-strategy-start
#| fig-cap: "Prinos investicijske strategije"

g1 = chart.CumReturns(returns_xts_, plot.engine = "ggplot2") +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  theme(
    legend.position = "none"
  ) +
  scale_color_grey() +
  ggtitle("Prinos investicijske strategije")
g2 = chart.Drawdown(returns_xts_, plot.engine = "ggplot2") +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  theme(
    legend.position = "none"
  ) +
  scale_color_grey() +
  ggtitle("Drawdown investicijske strategije")
g1 / g2
```

Rezultati regresijske analize prikazani su u tablici @tab-calendar-reg-start. Vrijednost koeficijenta $β_1$ u ovoj specifikaciji gotovo je dvostruko manja u odnosu na originalnu specifikaciju te ima suprotan smjer (pozitivan). Pod pretpostavkom homoskedastičnosti, koeficijent je statistički značajan, ali uz znatno nižu razinu značajnosti. Kada se koriste robustne standardne pogreške (prilagođene heteroskedastičnosti), koeficijent gubi statističku značajnost. Ovi nalazi upućuju na to da kalendarski efekt nije prisutan u slučaju rebalansiranja na početku mjeseca, što dodatno potvrđuje zaključak da je efekt specifično vezan uz rebalansiranje fondova na kraju mjeseca. Na slici @fig-strategy-start prikazane su performanse IS temeljene na ovakvoj specifikaciji. Tijekom cijelog promatranog razdoblja IS nije ostvarila značajniji rast, te je ukupno izgubila preko 10 % vrijednosti. 

## Osjetljivost rezultata na broj dana krajem mjeseca

U osnovnom modelu izabran je 16. trgovinski dan kao početak posljednjeg razdoblja u mjesecu. U cilju provjere robusnosti rezultata, provedena je dodatna analiza u kojoj se varira početni dan između 11. i 20. trgovinskog dana. Primjerice, ako se kao početni dan uzme 11., tada se prinosi od 1. do 11. dana promatraju kao prvi period, a prinosi od 11. do 21. dana kao drugi (test) period. 

```{r}
# Function to calculate outperformance based on number of days
calculate_outperformance = function(n_days) {
  # Calculate returns 5 day before end of the month and returns last 5 days of the month
  ret_1 = dt[, .(ret_1 = .SD[day_of_month == 1, last_value] / .SD[day_of_month == n_days, last_value] - 1),
     by = .(symbol, month)]
  ret_2 = dt[, .(ret_2 = data.table::last(.SD[, last_value]) / .SD[day_of_month == n_days, last_value] - 1),
     by = .(symbol, month)]
  
  # Merge ret_1 and ret_2
  returns_vars = merge(ret_1, ret_2, by = c("symbol", "month"))
  returns_vars = dcast(returns_vars, month ~ symbol, 
                       value.var = c("ret_1", "ret_2"))
  returns = na.omit(returns_vars)
  
  # Ratio of Crobex and Crobis
  returns[, ratio := ret_1_crobex - ret_1_crobis]
  
  # Momentum
  returns[, mom_month := shift(ratio, 1) / shift(ratio, 2) - 1]
  returns[, mom_year := shift(ratio, 1) / shift(ratio, 12) - 1]
  
  # Strategy
  returns[, strategy := ifelse(ret_1_crobex > ret_1_crobis, ret_2_crobis, ret_2_crobex)]
  returns[, strategy_big := ifelse(ret_1_crobex > (ret_1_crobis + 0.03), ret_2_crobis, ret_2_crobex)]
  
  # Strategy
  returns[, strategy := ifelse(ret_1_crobex > ret_1_crobis, ret_2_crobis, ret_2_crobex)]
  returns[, strategy_big := ifelse(ret_1_crobex > (ret_1_crobis + 0.03), ret_2_crobis, ret_2_crobex)]
  returns_xts = as.xts.data.table(returns[, .(zoo::as.Date.yearmon(month), strategy)])
  
  names(returns_xts) = n_days
  
  return(returns_xts)
}

# Calculate outperformance for different number of days
outperformances = lapply(11:20, calculate_outperformance)
outperformances_xts = Reduce(function(x, y) merge(x, y), outperformances)
```

```{r}
#| label: fig-strategy-days
#| fig-cap: "Prinos investicijske strategije uz različite veličine perioda"

performances = Reduce(function(x, y) merge(x, y), 
                      lapply(outperformances_xts, performance))
performances_dt = as.data.table(t(performances[1, 2:ncol(performances)]), keep.rownames = TRUE)
setnames(performances_dt, c("index", "performance"))
performances_dt |>
  ggplot(aes(x = gsub("X", "", index), y = performance)) +
  geom_bar(stat = "identity") +
  labs(y = "Sharpeov omjer", x = "Trgovinski dan kupnje") +
  # add crobex return as benchmark
  geom_hline(yintercept = as.numeric(performance(crobex_xts[, 2])[1, 2]), linetype = "dashed") +
  geom_text(aes(x = 10, y = as.numeric(performance(crobex_xts[, 2])[1, 2]), label = "CROBEX"), vjust = -1) +
  theme_minimal()
```

Na slici @fig-strategy-days prikazan je Sharpeov omjer investicijske strategije za sve odabrane početne dane. Vidljivo je da je Sharpeov omjer najviši upravo u osnovnoj varijanti (16. trgovinski dan), gdje dostiže 0,88, što je znatno iznad vrijednosti za CROBEX. S udaljavanjem od 16. dana (bilo prema ranijem ili kasnijem datumu), Sharpeov omjer opada. Ovi nalazi ukazuju na to da je osnovna postavka s 16. danom optimalna te time potvrđuju stabilnost i robusnost bazičnog modela

{{< pagebreak >}}

# Zaključak

Rezultati istraživanja potvrđuju postojanje kalendarskog efekta rebalansiranja na Zagrebačkoj burzi. Regresijska analiza ukazuje na negativan odnos razlika prinosa dionica i obveznica u prvoj polovici mjeseca te njihovih razlika u posljednjem tjednu, što sugerira sustavni povratak cijena prema ravnoteži. Nadalje, simulacija investicijske strategije temeljene na ovom efektu pokazala je znatno bolje performanse u usporedbi s jednostavnim pristupom „kupi i drži”.
Analiza robusnosti dodatno je potvrdila ovakve nalaze, pri čemu je potvrđeno kako kalendarski efekt nije prisutan na početku mjeseca, što isključuje mogućnost da je uočeni obrazac rezultat općih tržišnih trendova. Uz to, promjenom broja dana za obračun razdoblja potvrđeno je da je bazična postavka optimalna, pružajući dodatnu sigurnost u stabilnost rezultata.

Ovi zaključci imaju važne implikacije za investicijske fondove, koji bi mogli razmotriti optimizaciju kalendarskog načina rebalansiranja kako bi smanjili transakcijske troškove i tržišne distorzije. Također, investitori s višom tolerancijom prema riziku mogu iskoristiti kalendarski efekt za oblikovanje vlastitih strategija trgovanja, dok regulatorna tijela i tvorci politika mogu rezultate primijeniti pri donošenju smjernica za efikasnije funkcioniranje tržišta kapitala u Hrvatskoj.

Istovremeno, ova studija ima i određena ograničenja. Procjena kalendarskog efekta temelji se na aproksimaciji ponašanja mirovinskih fondova, budući da detaljni podaci o točnim rebalansima nisu javno dostupni. Moguće je da postoje i drugi faktori koji objašnjavaju uspješnost investicijske strategije, poput takozvanih „zoo faktora“, koji u ovoj analizi nisu bili obuhvaćeni. Konačno, pretpostavka linearnosti odnosa može biti pojednostavljenje stvarnih tržišnih mehanizama, s obzirom na to da su nelinearnosti i promjene tržišnih režima česte u financijskom okruženju. Potencijalna nadogradnja rada stoga uključuje analizu pojačanom novim skupovima podataka te razmatranje alternativnih nelinearnih pristupa


# Reference


